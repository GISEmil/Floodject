# -*- coding: utf-8 -*-
from flask import Flask, request, redirect, url_for, send_from_directory, render_template
from werkzeug import secure_filename
import os, time

UPLOAD_FOLDER = '/var/www/html/FlaskApp/FlaskApp/'
#ALLOWED_EXTENSIONS = set(['tif'])

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER

def allowed_file(filename):
	return '.' in filename and \
		filename.rsplit('.', 1)[1] in ALLOWED_EXTENSIONS


@app.route('/')
def hello_world():
	return render_template('index')

@app.route('/upload', methods=['GET', 'POST'])
def upload_file():
	if request.method == 'POST':
		file = request.files['datafile']
		if file:
			filename = time.strftime("%d%m%y%H%M")
			#filename = secure_filename(file.filename)
			file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
			return redirect(url_for('upload_file', filename=filename)))

	return '''
	<!DOCTYPE html>
	<html>
	<head>
		<title>Flood Mitigation Online Tool</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<script src="http://code.jquery.com/jquery-2.1.1.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<style type="text/css">
			#map { min-height: 320px; height: 530px; width: 530px;}
			body {
				padding: 0;
				margin: 0;
			}
			html, body, {
				height: 100%;
			}
	
		</style>

	</head>
	<body>
	
		<div id="map" style = "width = 50%;height=100%;position=absolute:"></div>
		<script src="http://leafletjs.com/dist/leaflet.js"></script>
	
		<form action="" method="post" enctype="multipart/form-data">
			<input type="file" name="datafile" id= "datafile" accept="image/*">
			<input type="submit" value = "Upload Image" name="submit">
		</form>
	

		<script>
		var map = L.map('map').setView([0, 0], 13);
		L.tileLayer('http://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		maxZoom: 18
	}).addTo(map);
	
		</script>
	</body>
	</html>

	'''
